<html>
	<head>
		<title> Virtual REALITY! </title>
		<script src="aframe.min.js"></script>
		<script>
			AFRAME.registerComponent('raycaster-autorefresh', {
				init: function () {
					var el = this.el;
					this.el.addEventListener('model-loaded', function () {
						var cursorEl = el.querySelector('[raycaster]');
						cursorEl.components.raycaster.refreshObjects();
					  });
				   	}
				});

				AFRAME.registerComponent('fusable', {
					init: function () {
						this.cursorEl = document.querySelector('a-cursor');
						this.fusing = this.fusing.bind(this);
						this.el.addEventListener('fusing', this.fusing);
					},
					fusing: function() {
						this.cursorEl.dispatchEvent(new Event('start-fusing'));
					},
					remove: function() {
						this.el.removeEventListener('fusing', this.fusing);
					}
				});

			AFRAME.registerComponent('door-listener', {
				init: function () {
					var el = this.el;
					this.el.addEventListener('click', function (evt) {
						var camera = document.querySelector('a-camera');
						el.dispatchEvent(new Event('open-door'));
					});
				}
			});

		</script>
	</head>
		<body>
			<a-scene raycaster-autorefresh>

				<a-assets>
					<a-asset-item id="wall" src="resources/wall.gltf"></a-asset-item>
					<img id="carpet" src="resources/carpet.jpg">
					<a-asset-item id="sofa" src="resources/burlap_sofa.gltf"></a-asset-item>
					<a-asset-item id="door" src="resources/door.gltf"></a-asset-item> 
				</a-assets>

			<!-- light -->
				<a-light type="directional" color="#fff" intensity="0.8" position="2 4 2" rotation="0 0 0"></a-light> 
				<a-light type="directional" color="#fff" intensity="0.8" position="-2 0 -2" rotation="0 0 0"></a-light>
				<a-sky color="rgb(165,252,255)"></a-sky> 
			<!-- camera -->
				<a-camera position="0 2 0"> 
					<a-cursor fuse="true" fuse-timeout="750"></a-cursor>
						<!-- shapes -->
						<a-animation begin="start-fusing" easing="ease-in" attribute="scale" dur="750" fill="backwards" from="1 1 1" to="0.2 0.2 0.2">
						</a-animation>
					</a-cursor> 
				</a-camera>

			<!-- shapes -->
				<a-box position="2 2 -3.25" rotation="0 45 0" color="#0047a5"></a-box>
				<a-sphere position="3 2.25 -4.5" radius="1" color="#8e1c0b"></a-sphere>
				<a-cylinder position="3.25 2.25 -3" radius="0.5" height="1.5" color="#a56300"></a-cylinder>

			<!-- side walls! -->
				<a-box position="4 5.5 -6" rotation="0 -90 0" depth=".05" width="16" height="8" color="#534928"></a-box>
				<a-box position="-4 5.5 -6" rotation="0 -90 0" depth=".05" width="16" height="8" color="#5e4928"></a-box>
				<a-box position="0 5.5 -14" rotation="0 0 0" depth=".05" width="8" height="8" color="#5e4928"></a-box>

			<!-- Carpet and ceiling-->
				<a-plane position="0 1.5 -6" src="#carpet" repeat="90 90" rotation="-90 0 0" width="8" height="16" color="#680707"></a-plane> 
				<a-box position="0 9 -6" rotation="-270 0 0" depth=".05" width="8" height="16" color="#5e4928"></a-box>

			<!-- image wall GLTF -->
				<a-gltf-model scale="1.7 1.7 1.7" position="0.3 1.5 -5.6" rotation="0 0 0" src="#wall"></a-gltf-model>

				<!-- sofa -->
				<a-gltf-model scale="1.7 1.7 1.7" position="3.7 1.5 0.75" rotation="0 -90 0" src="#sofa"></a-gltf-model>
				<!-- wall -->
				<a-gltf-model scale="1.7 1.7 1.7" position="0.3 1.5 2" rotation="0 0 0" src="#wall"></a-gltf-model>

				<!-- door -->
				<a-gltf-model scale="1.7 1.7 1.7" position="-1.95 1.5 -5.6" rotation="0 -180 0" src="#door" door-listener fusable clickable>
				<a-gltf-model scale="1.7 1.7 1.7" position="-1.95 1.5 2" rotation="0 -180 0" src="#door" door-listener fusable clickable>

				<a-animation begin="open-door" attribute="rotation" to="0 -50 0" dur="1500"></a-animation>
				<a-animation begin="open-door" attribute="position" to="-2 1.5 -5.6" dur="1500"></a-animation>
				</a-gltf-model>
		</a-scene>
	</body>
</html>